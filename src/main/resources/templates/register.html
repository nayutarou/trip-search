<!DOCTYPE html>
<html lang="ja" xmlns:th="http://www.thymeleaf.org">

<head th:replace="~{ layout :: head(ユーザ登録,@{/css/auth/regist.css})}">
</head>

<body>
<div>
    <div class="content">
        <h1>SignUp!</h1>
        <form th:action="@{/register}" method="post" th:object="${userForm}">
            <div class="email">
                <p>メールアドレス :</p>
                <input type="email" name="email" th:field="*{email}" placeholder="メールアドレスを入力してください">
            </div>
            <div class="password">
                <p>パスワード :</p>
                <input type="password" name="password" th:field="*{password}" placeholder="パスワードを入力してください">
            </div>
            <div class="confirm">
                <p>パスワード(確認用) :</p>
                <input type="password" name="confirm" id="password-confirm" placeholder="パスワードを入力してください">
                <p id="password-message" style="font-size: 0.9em;"></p>
            </div>
            <div th:if="${param.error}" class="error">
                <p>そのメールアドレスは既に登録済みです。</p>
                <p>新しく入力しなおすか、ログインしてください。</p>
            </div>

            <button type="submit">会員登録</button>
            <p class="login">既存ユーザーですか？<a th:href="@{/login}">ログイン</a></p>
        </form>
    </div>
</div>

<script>
    // HTMLの要素をあらかじめ取得しておく
    const passwordField = document.getElementById('password');
    const passwordConfirmField = document.getElementById('password-confirm');
    const messageElement = document.getElementById('password-message');
    const submitButton = document.getElementById('submit-button');

    // パスワードをチェックする関数
    const checkPasswords = () => {
        const password = passwordField.value;
        const passwordConfirm = passwordConfirmField.value;

        // どちらかのフィールドが空の場合は、メッセージを消して何もしない
        if (password === '' && passwordConfirm === '') {
            messageElement.textContent = '';
            submitButton.disabled = false; // 送信ボタンは有効にしておく
            return;
        }

        // パスワードが一致しているかチェック
        if (password === passwordConfirm) {
            // 一致している場合
            messageElement.textContent = 'パスワードが一致しました';
            messageElement.style.color = 'green'; // 文字を緑色に
            submitButton.disabled = false; // 送信ボタンを有効化
        } else {
            // 一致しない場合
            messageElement.textContent = 'パスワードが一致しません';
            messageElement.style.color = 'red'; // 文字を赤色に
            submitButton.disabled = true; // 送信ボタンを無効化
        }
    };

    // パスワード入力欄でキーをタイプするたびに関数を呼び出す
    passwordField.addEventListener('keyup', checkPasswords);
    // 確認用パスワード入力欄でキーをタイプするたびに関数を呼び出す
    passwordConfirmField.addEventListener('keyup', checkPasswords);
</script>
</body>

</html>
